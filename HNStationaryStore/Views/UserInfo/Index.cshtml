@model HNStationaryStore.Models.OrderViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" type="text/css" href="~/Content/assets/styles/contact_styles.css">
<link rel="stylesheet" type="text/css" href="~/Content/assets/styles/contact_responsive.css">
<div class="container contact_container">

    <!-- Breadcrumbs -->

    <div class="breadcrumbs d-flex flex-row align-items-center">
        <ul>
            <li><a href="/">Trang chủ</a></li>
            <li class="active"><a><i class="fa fa-angle-right" aria-hidden="true"></i>Thông tin cá nhân</a></li>
        </ul>
    </div>
    <div class="row">
        <div class="col-4">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0 text-white text-center">Thông tin cá nhân</h5>
                </div>
                <div class="card-body">
                    <form>
                        <div class="mb-3">
                            <p><strong>Họ và tên:</strong> @Model.CustomerName</p>
                        </div>

                        <div class="mb-3">
                            <p><strong>Số điện thoại:</strong> @Model.Phone</p>
                        </div>

                        <div class="mb-3">
                            <p><strong>Địa chỉ:</strong> @Model.Address</p>
                        </div>

                        <div class="mb-3">
                            <p><strong>Email:</strong> @Model.Email</p>
                        </div>

                        <button type="button" class="btn btn-primary mt-2" data-toggle="modal" data-target="#editModal">
                            Thay đổi thông tin
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-8">
            <h3>Thông tin đơn hàng</h3>

            @if (Model.Orders != null && Model.Orders.Any())
            {
                <table class="table table-striped mt-3">
                    <thead >
                        <tr class="bg-danger text-white">
                            <th>Mã đơn</th>
                            <th>Ngày đặt</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model.Orders)
                        {
                            <tr>
                                <td>@order.Code</td>
                                <td>@order.CreatedAt.ToString("dd/MM/yyyy")</td>
                                <td>@order.TotalPrice.ToString("N0") đ</td>
                                <td>
                                    @{
                                        string statusText = "";
                                        switch (order.OrderStatus)
                                        {
                                            case HNStationaryStore.Models.EF.OrderStatus.Success:
                                                statusText = "Đặt hàng thành công";
                                                break;
                                            case HNStationaryStore.Models.EF.OrderStatus.Shipping:
                                                statusText = "Đang vận chuyển";
                                                break;
                                            case HNStationaryStore.Models.EF.OrderStatus.Delivered:
                                                statusText = "Đã giao hàng";
                                                break;
                                            case HNStationaryStore.Models.EF.OrderStatus.Cancelled:
                                                statusText = "Đã hủy";
                                                break;
                                        }
                                    }
                                    @statusText
                                </td>
                                <td>
                                    @if (order.OrderStatus == HNStationaryStore.Models.EF.OrderStatus.Success)
                                    {
                                        <form action="@Url.Action("CancelOrder", "UserInfo")" method="post" onsubmit="return confirm('Bạn có chắc muốn hủy đơn hàng này?');">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="orderId" value="@order.OrderID" />
                                            <button type="submit" class="btn btn-danger btn-sm">Hủy đơn</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <span>-</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>Không có đơn hàng nào.</p>
            }
        </div>
    </div>

    <!-- Modal chỉnh sửa -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            @using (Html.BeginForm("UpdateUserInfo", "UserInfo", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="editModalLabel">Cập nhật thông tin</h5>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Họ và tên</label>
                            @Html.TextBoxFor(m => m.CustomerName, new { @class = "form-control", required = "required" })
                        </div>
                        <div class="form-group">
                            <label>Số điện thoại</label>
                            @Html.TextBoxFor(m => m.Phone, new { @class = "form-control", required = "required" })
                        </div>
                        <div class="form-group">
                            <label>Địa chỉ</label>
                            @Html.TextBoxFor(m => m.Address, new { @class = "form-control", required = "required" })
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", required = "required", type = "email" })
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Lưu</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                    </div>
                </div>
            }
        </div>
    </div>

        @section scripts{
            <script src="~/Content/assets/js/contact_custom.js"></script>
        }
